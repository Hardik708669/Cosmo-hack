<%- include('partials/header', { title: 'Dark Web Monitoring - SecureGuard' }) %>
<%- include('partials/sidebar', { page: 'darkweb-monitor' }) %>

<div class="main-content">
    <div class="container">
        <div class="fade-in-left">
            <h1 class="text-gradient-emerald">üïµÔ∏è Dark Web Monitoring</h1>
            <p style="color: #64748B; margin-top: 0.5rem;">Monitor dark web for leaked credentials and sensitive data</p>
        </div>

        <div class="glass-card card-emerald fade-in-up" style="margin-top: 2rem;">
            <form id="darkwebForm">
                <div class="form-group">
                    <label class="form-label" for="domain">Domain or Email to Monitor</label>
                    <input type="text" id="domain" name="domain" class="form-input" placeholder="example.com or email@domain.com" required>
                </div>
                <button type="submit" class="btn btn-primary">Start Monitoring</button>
            </form>
        </div>

        <div id="monitorResults" style="display: none;" class="glass-card fade-in-up" style="margin-top: 2rem;">
            <h3 style="color: var(--light-emerald); margin-bottom: 1.5rem;">Monitoring Results</h3>
            <div id="resultsContent"></div>
        </div>

        <div class="glass-card fade-in-up" style="margin-top: 2rem;">
            <h3 style="color: var(--light-gold); margin-bottom: 1.5rem;">üîî Active Monitors</h3>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Target</th>
                            <th>Status</th>
                            <th>Alerts</th>
                            <th>Last Scan</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="monitorsTable">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #64748B;">No active monitors. Add one above.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('darkwebForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const domain = document.getElementById('domain').value;
    const resultsDiv = document.getElementById('monitorResults');
    const resultsContent = document.getElementById('resultsContent');
    
    resultsContent.innerHTML = '<div class="loading">Scanning dark web sources...</div>';
    resultsDiv.style.display = 'block';
    
    try {
        const response = await fetch('/api/darkweb-monitor', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ domain })
        });
        
        const data = await response.json();
        
        resultsContent.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${data.found ? 'üö®' : '‚úÖ'}</div>
                    <div class="stat-label">Status</div>
                    <div style="color: ${data.found ? '#FCA5A5' : 'var(--light-emerald)'}; font-weight: 600; margin-top: 0.5rem;">
                        ${data.found ? 'Data Found' : 'Clean'}
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üåê</div>
                    <div class="stat-label">Sources Scanned</div>
                    <div style="color: #94A3B8; font-weight: 600; margin-top: 0.5rem;">${data.sourcesScanned}</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ö†Ô∏è</div>
                    <div class="stat-label">Alerts</div>
                    <div style="color: var(--light-gold); font-weight: 600; margin-top: 0.5rem;">${data.alertCount}</div>
                </div>
            </div>
            ${data.found ? `
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #EF4444; margin-bottom: 1.5rem;">
                    <h4 style="color: #FCA5A5; margin-bottom: 1rem;">üö® Dark Web Findings</h4>
                    <ul style="color: #CBD5E1; line-height: 1.8;">
                        ${data.findings.map(f => `<li><strong>${f.type}</strong>: ${f.description} (Found: ${f.date})</li>`).join('')}
                    </ul>
                </div>
                <div class="alert alert-error">
                    <strong>Action Required:</strong> Your data has been found on dark web sources. Change passwords immediately and enable 2FA.
                </div>
            ` : `
                <div class="alert alert-success">
                    No data found on dark web sources. Monitoring will continue automatically.
                </div>
            `}
        `;
        
        // Update monitors table
        updateMonitorsTable();
    } catch (error) {
        resultsContent.innerHTML = '<div class="alert alert-error">Error monitoring dark web. Please try again.</div>';
    }
});

function updateMonitorsTable() {
    // Simulated active monitors
    const monitorsTable = document.getElementById('monitorsTable');
    monitorsTable.innerHTML = `
        <tr>
            <td>${document.getElementById('domain').value}</td>
            <td><span class="badge badge-active">Active</span></td>
            <td>0</td>
            <td>Just now</td>
            <td><button class="btn btn-secondary" style="padding: 0.5rem;">Stop</button></td>
        </tr>
    `;
}
</script>

<%- include('partials/footer') %>