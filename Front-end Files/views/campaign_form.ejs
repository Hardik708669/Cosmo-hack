<%- include('partials/header', { title: 'New Campaign - PhishGuard' }) %>
<%- include('partials/sidebar', { page: 'campaigns' }) %>

<div class="main-content">
    <div class="container">
        <h1>Create New Campaign</h1>
        
        <div class="glass-card">
            <form action="/campaigns" method="POST" id="campaignForm">
                <div class="form-group">
                    <label class="form-label" for="name">Campaign Name</label>
                    <input type="text" id="name" name="name" class="form-input" 
                           placeholder="Enter campaign name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="template">Email Template</label>
                    <select id="template" name="templateId" class="form-input" required>
                        <option value="">Select a template</option>
                        <% if (templates && templates.length > 0) { %>
                            <% templates.forEach(template => { %>
                                <option value="<%= template.id %>"><%= template.name %></option>
                            <% }) %>
                        <% } %>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="targetGroup">Target Group</label>
                    <select id="targetGroup" name="targetGroup" class="form-input" required>
                        <option value="">Select target group</option>
                        <option value="Sales">Sales</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Marketing">Marketing</option>
                        <option value="HR">HR</option>
                        <option value="Finance">Finance</option>
                        <option value="All">All Users</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="scheduleType">Schedule</label>
                    <select id="scheduleType" name="scheduleType" class="form-input" onchange="toggleSchedule()">
                        <option value="immediate">Send Immediately</option>
                        <option value="scheduled">Schedule for Later</option>
                    </select>
                </div>
                
                <div class="form-group" id="scheduleDateTime" style="display: none;">
                    <label class="form-label" for="scheduledAt">Schedule Date & Time</label>
                    <input type="datetime-local" id="scheduledAt" name="scheduledAt" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="description">Description (Optional)</label>
                    <textarea id="description" name="description" class="form-input" rows="3" 
                              placeholder="Enter campaign description"></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">Create Campaign</button>
                    <a href="/campaigns" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
        
        <div class="glass-card" style="margin-top: 2rem;">
            <h3>Campaign Preview</h3>
            <div id="campaignPreview">
                <p style="color: #aaa;">Select a template to see preview</p>
            </div>
        </div>
    </div>
</div>

<script>
function toggleSchedule() {
    const scheduleType = document.getElementById('scheduleType').value;
    const scheduleDateTime = document.getElementById('scheduleDateTime');
    
    if (scheduleType === 'scheduled') {
        scheduleDateTime.style.display = 'block';
        document.getElementById('scheduledAt').required = true;
    } else {
        scheduleDateTime.style.display = 'none';
        document.getElementById('scheduledAt').required = false;
    }
}

document.getElementById('template').addEventListener('change', function() {
    const templateId = this.value;
    if (templateId) {
        // Fetch template preview
        fetch(`/templates/${templateId}/preview`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('campaignPreview').innerHTML = `
                    <h4>${data.subject}</h4>
                    <div style="border: 1px solid var(--glass-border); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                        ${data.body}
                    </div>
                `;
            })
            .catch(() => {
                document.getElementById('campaignPreview').innerHTML = '<p style="color: #aaa;">Error loading preview</p>';
            });
    } else {
        document.getElementById('campaignPreview').innerHTML = '<p style="color: #aaa;">Select a template to see preview</p>';
    }
});
</script>

<%- include('partials/footer') %>