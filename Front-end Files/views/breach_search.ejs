<%- include('partials/header', { title: 'Data Breach Search - SecureGuard' }) %>
<%- include('partials/sidebar', { page: 'breach-search' }) %>

<div class="main-content">
    <div class="container">
        <div class="fade-in-left">
            <h1 class="text-gradient-emerald">üîì Data Breach Search</h1>
            <p style="color: #64748B; margin-top: 0.5rem;">Check if your email or credentials have been compromised</p>
        </div>

        <div class="glass-card card-gold fade-in-up" style="margin-top: 2rem;">
            <form id="breachSearchForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email Address or Username</label>
                    <input type="text" id="email" name="email" class="form-input" placeholder="Enter email or username" required>
                </div>
                <button type="submit" class="btn btn-primary">Search Breaches</button>
            </form>
        </div>

        <div id="searchResults" style="display: none;" class="glass-card fade-in-up" style="margin-top: 2rem;">
            <h3 style="color: var(--light-gold); margin-bottom: 1.5rem;">Search Results</h3>
            <div id="resultsContent"></div>
        </div>
    </div>
</div>

<script>
document.getElementById('breachSearchForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const resultsDiv = document.getElementById('searchResults');
    const resultsContent = document.getElementById('resultsContent');
    
    resultsContent.innerHTML = '<div class="loading">Searching breach databases...</div>';
    resultsDiv.style.display = 'block';
    
    try {
        const response = await fetch('/api/breach-search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        resultsContent.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">${data.breached ? '‚ö†Ô∏è' : '‚úÖ'}</div>
                    <div class="stat-label">Status</div>
                    <div style="color: ${data.breached ? '#FCA5A5' : 'var(--light-emerald)'}; font-weight: 600; margin-top: 0.5rem;">
                        ${data.breached ? 'Compromised' : 'Safe'}
                    </div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üóÑÔ∏è</div>
                    <div class="stat-label">Breaches Found</div>
                    <div style="color: var(--light-gold); font-weight: 600; margin-top: 0.5rem;">${data.breachCount}</div>
                </div>
                <div class="stat-card">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÖ</div>
                    <div class="stat-label">Last Breach</div>
                    <div style="color: #94A3B8; font-weight: 600; margin-top: 0.5rem;">${data.lastBreach || 'N/A'}</div>
                </div>
            </div>
            ${data.breached ? `
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #EF4444; margin-bottom: 1.5rem;">
                    <h4 style="color: #FCA5A5; margin-bottom: 1rem;">‚ö†Ô∏è Compromised Data</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${data.compromisedData.map(d => `<span class="badge badge-pending">${d}</span>`).join('')}
                    </div>
                </div>
                <div style="background: rgba(30, 41, 59, 0.5); padding: 1.5rem; border-radius: 12px;">
                    <h4 style="color: var(--light-emerald); margin-bottom: 1rem;">Breach Sources</h4>
                    <ul style="color: #CBD5E1; line-height: 1.8;">
                        ${data.breaches.map(b => `<li><strong>${b.name}</strong> - ${b.date} (${b.records} records)</li>`).join('')}
                    </ul>
                </div>
            ` : `
                <div class="alert alert-success">
                    No breaches found for this email. Your credentials appear to be safe.
                </div>
            `}
        `;
    } catch (error) {
        resultsContent.innerHTML = '<div class="alert alert-error">Error searching breaches. Please try again.</div>';
    }
});
</script>

<%- include('partials/footer') %>